<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Manifest PWA -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Iconos de Apple para iOS -->
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Meta tags PWA iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Familia Gonz√°les">
    
    <!-- Meta tags PWA Android/General -->
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Sistema de gesti√≥n de pedidos, ventas y contabilidad para restaurante">
    <meta name="application-name" content="Familia Gonz√°les">
    
    <!-- Meta tags adicionales para mejor compatibilidad -->
    <meta name="msapplication-TileColor" content="#2563eb">
    <meta name="msapplication-TileImage" content="icon-192.png">
    <meta name="msapplication-config" content="none">
    
    <title>Familia Gonz√°les</title>
    <link rel="stylesheet" href="estilos.css">
    <!-- CDN para generar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- CDN para gr√°ficas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Banner de instalaci√≥n PWA -->
    <div id="install-banner" class="install-banner" style="display: none;">
        <p id="install-banner-text">üì± Instala esta app para acceso r√°pido y uso offline</p>
        <div class="install-buttons">
            <button id="install-btn">Instalar Ahora</button>
            <button id="dismiss-install">Ahora no</button>
        </div>
    </div>

    <!-- Contenedor principal -->
    <div class="container">
        <!-- Encabezado -->
        <header>
            <h1>üçΩÔ∏è Familia Gonz√°les</h1>
            <p class="subtitle">Gestiona pedidos, ventas y contabilidad</p>
            <div id="storage-status" class="storage-status success">‚úÖ Datos guardados correctamente</div>
        </header>

        <!-- Navegaci√≥n principal -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
            <button class="tab-btn" data-tab="ventas">Pedidos</button>
            <button class="tab-btn" data-tab="gastos">Gastos</button>
        </nav>

        <!-- Secci√≥n Dashboard -->
        <section id="dashboard" class="tab-content active">
            <h2>üìà Resumen General</h2>
            
            <!-- Tarjetas de resumen -->
            <div class="cards-container">
                <div class="card card-ingreso">
                    <div class="card-icon">üí∞</div>
                    <div class="card-content">
                        <h3>Ingresos del D√≠a</h3>
                        <p class="card-amount" id="ingreso-hoy">$0.00</p>
                    </div>
                </div>
                
                <div class="card card-egreso">
                    <div class="card-icon">üí∏</div>
                    <div class="card-content">
                        <h3>Gastos del D√≠a</h3>
                        <p class="card-amount" id="gasto-hoy">$0.00</p>
                    </div>
                </div>
                
                <div class="card card-saldo">
                    <div class="card-icon">üíµ</div>
                    <div class="card-content">
                        <h3>Saldo del D√≠a</h3>
                        <p class="card-amount" id="saldo-hoy">$0.00</p>
                    </div>
                </div>
                
                <div class="card card-total">
                    <div class="card-icon">üè¶</div>
                    <div class="card-content">
                        <h3>Saldo Total</h3>
                        <p class="card-amount" id="saldo-total">$0.00</p>
                    </div>
                </div>
            </div>

            <!-- Resumen por per√≠odos -->
            <div class="summary-section">
                <h3>Resumen por Per√≠odo</h3>
                <div class="period-cards">
                    <div class="period-card">
                        <h4>Esta Semana</h4>
                        <div class="period-detail">
                            <p>Ingresos: <span id="ingreso-semana">$0.00</span></p>
                            <p>Gastos: <span id="gasto-semana">$0.00</span></p>
                            <p class="period-amount" id="saldo-semana">$0.00</p>
                            <p style="font-size: 13px; color: #666;">Propinas: <span id="propinas-semana">$0.00</span></p>
                        </div>
                    </div>
                    <div class="period-card">
                        <h4>Este Mes</h4>
                        <div class="period-detail">
                            <p>Ingresos: <span id="ingreso-mes">$0.00</span></p>
                            <p>Gastos: <span id="gasto-mes">$0.00</span></p>
                            <p class="period-amount" id="saldo-mes">$0.00</p>
                            <p style="font-size: 13px; color: #666;">Propinas: <span id="propinas-mes">$0.00</span></p>
                        </div>
                    </div>
                    <div class="period-card">
                        <h4>Total General</h4>
                        <div class="period-detail">
                            <p>Ingresos: <span id="ingreso-total">$0.00</span></p>
                            <p>Gastos: <span id="gasto-total">$0.00</span></p>
                            <p class="period-amount" id="saldo-total-general">$0.00</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gr√°fica -->
            <div class="chart-container" style="margin: 30px 0; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3>üìä √öltimos 7 D√≠as</h3>
                <canvas id="chart-ventas" style="max-height: 300px;"></canvas>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="dashboard-actions" style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="generarReporteSemanal()" class="btn btn-primary" style="flex: 1; min-width: 200px;">
                    üìä Reporte Semanal
                </button>
                <button onclick="exportarPDF()" class="btn btn-primary" style="flex: 1; min-width: 200px;">
                    üìÑ Exportar PDF
                </button>
                <button onclick="exportarDatos()" class="btn btn-secondary" style="flex: 1; min-width: 200px;">
                    üíæ Exportar Respaldo
                </button>
                <button onclick="importarDatos()" class="btn btn-secondary" style="flex: 1; min-width: 200px;">
                    üì• Importar Respaldo
                </button>
            </div>
        </section>

        <!-- Secci√≥n Pedidos (anteriormente Ventas) -->
        <section id="ventas" class="tab-content">
            <h2>üçΩÔ∏è Registrar Pedido por Mesa</h2>
            
            <!-- Formulario de pedido -->
            <form id="form-pedido" class="form-container">
                <!-- Tabla Unificada: Datos de Mesa + Art√≠culos -->
                <div class="form-section" style="background: #fff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #e0e0e0;">
                    <h3 style="color: #2196F3; margin-bottom: 15px;">üçΩÔ∏è Registrar Pedido por Mesa</h3>
                    
                    <table id="tabla-articulos">
                        <thead>
                            <tr>
                                <th>DESCRIPCION</th>
                                <th>PRECIO</th>
                                <th>CANTIDAD</th>
                                <th>SUB_TOTAL</th>
                                <th>ACCIONES</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-articulos">
                            <!-- Fila de datos de la mesa -->
                            <tr id="fila-datos-mesa" style="background-color: #f0f8ff;">
                                <td>
                                    <div style="display: flex; flex-direction: column; gap: 10px;">
                                        <div>
                                            <label for="pedido-fecha" style="font-size: 11px; color: #666; display: block; margin-bottom: 3px;">Fecha:</label>
                                            <input type="date" id="pedido-fecha" required style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                        </div>
                                        <div>
                                            <label for="pedido-cliente" style="font-size: 11px; color: #666; display: block; margin-bottom: 3px;">Cliente:</label>
                                            <input type="text" 
                                                   id="pedido-cliente" 
                                                   list="lista-clientes"
                                                   placeholder="Nombre del cliente" 
                                                   required
                                                   style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                            <datalist id="lista-clientes"></datalist>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        <label for="pedido-mesa" style="font-size: 11px; color: #666; display: block; margin-bottom: 3px;">Mesa:</label>
                                        <input type="text" 
                                               id="pedido-mesa" 
                                               placeholder="N√∫mero de mesa" 
                                               required
                                               style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        <label for="pedido-mesero" style="font-size: 11px; color: #666; display: block; margin-bottom: 3px;">Mesero:</label>
                                        <input type="text" 
                                               id="pedido-mesero" 
                                               list="lista-meseros"
                                               placeholder="Nombre del mesero" 
                                               required
                                               style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                                        <datalist id="lista-meseros"></datalist>
                                    </div>
                                </td>
                                <td>
                                    <div style="text-align: right; padding-top: 20px;">
                                        <strong style="font-size: 14px;">TOTAL:</strong><br>
                                        <span id="pedido-total" style="font-size: 18px; color: #2196F3; font-weight: bold;">$0.00</span>
                                    </div>
                                </td>
                                <td>
                                    <!-- Bot√≥n movido abajo -->
                                </td>
                            </tr>
                            <!-- Las filas de art√≠culos se agregan din√°micamente con JavaScript -->
                        </tbody>
                    </table>
                    
                    <datalist id="lista-descripciones"></datalist>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button type="button" 
                            id="btn-agregar-articulo"
                            onclick="agregarArticulo()" 
                            class="btn-agregar-fila"
                            style="flex: 1; padding: 15px; font-size: 16px; font-weight: 600;">
                        ‚ûï Agregar otra fila
                    </button>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 18px; font-size: 18px; font-weight: 600; background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);">
                    üíæ GUARDAR PEDIDO
                </button>
            </form>
            
            <hr style="margin: 40px 0; border: none; border-top: 2px solid #e0e0e0;">
            
            <h2 style="margin-bottom: 20px;">üìã Lista de Pedidos</h2>
            <div id="ventas-list"></div>
        </section>

        <!-- Secci√≥n Gastos -->
        <section id="gastos" class="tab-content">
            <h2>üí≥ Registrar Gasto</h2>
            
            <!-- Formulario de gasto -->
            <form id="form-gasto" class="form-container">
                <div class="form-group">
                    <label for="gasto-fecha">Fecha:</label>
                    <input type="date" id="gasto-fecha" required>
                </div>
                
                <div class="form-group">
                    <label for="gasto-categoria">Categor√≠a:</label>
                    <select id="gasto-categoria" required>
                        <option value="">Seleccionar...</option>
                        <option value="Renta">Renta</option>
                        <option value="Servicios">Servicios</option>
                        <option value="Inventario">Inventario</option>
                        <option value="Sueldos">Sueldos</option>
                        <option value="Marketing-Publicidad">Marketing-Publicidad</option>
                        <option value="Mantenimiento">Mantenimiento</option>
                        <option value="Impuestos">Impuestos</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="gasto-concepto">Concepto del Gasto:</label>
                    <input type="text" id="gasto-concepto" placeholder="Ej: Renta, Servicios, Inventario" required>
                </div>
                
                <div class="form-group">
                    <label for="gasto-monto">Monto:</label>
                    <input type="number" id="gasto-monto" min="0" step="0.01" placeholder="0.00" required>
                </div>
                
                <button type="submit" class="btn btn-primary">üíæ Guardar Gasto</button>
            </form>

            <!-- Lista de gastos -->
            <div class="records-section" style="margin-top: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <h3 style="margin: 0;">Historial de Gastos</h3>
                    <div class="form-group" style="margin: 0; min-width: 200px;">
                        <label for="filtro-categoria">Filtrar por Categor√≠a:</label>
                        <select id="filtro-categoria" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">Todas las categor√≠as</option>
                            <option value="Renta">Renta</option>
                            <option value="Servicios">Servicios</option>
                            <option value="Inventario">Inventario</option>
                            <option value="Sueldos">Sueldos</option>
                            <option value="Marketing-Publicidad">Marketing-Publicidad</option>
                            <option value="Mantenimiento">Mantenimiento</option>
                            <option value="Impuestos">Impuestos</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                </div>
                <div id="gastos-list"></div>
            </div>
        </section>


        <!-- Secci√≥n de borrar todo -->
        <div class="danger-section" style="margin-top: 50px; background: #fff3f3; padding: 25px; border-radius: 10px; border: 2px solid #f44336;">
            <h3 style="color: #f44336;">üóëÔ∏è Administraci√≥n de Datos</h3>
            <p class="danger-warning" style="color: #d32f2f; margin: 15px 0; font-size: 14px;">
                ‚ö†Ô∏è <strong>ADVERTENCIA:</strong> Esta acci√≥n eliminar√° permanentemente todos tus pedidos y gastos. No se puede deshacer.
            </p>
            <div class="danger-buttons">
                <button id="btn-borrar-todo" class="btn btn-danger btn-large" style="padding: 15px 30px; font-size: 16px; font-weight: 600;">
                    üóëÔ∏è Borrar Todos los Datos
                </button>
            </div>
        </div>
    </div>

<!-- 1. PRIMERO: Sistema de Licencias -->
<script src="licencias.js"></script>

<!-- 2. SEGUNDO: Sistema de Login -->
<script src="login.js"></script>

<!-- 3. TERCERO: App Principal -->
<script src="app.js"></script>

</body>
</html>